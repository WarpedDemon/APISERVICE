{"changed":true,"filter":false,"title":"PHPAPI.php","tooltip":"/PHPAPI.php","value":"<?php\n\n/*   #API o' Magic # \n   [Partially Commented Version] */\n   \n   \n/*\n\n[Request List]:\n\n\t- 'Login' - Authenticates requesting user and returns all information stored in the database associated with\n\t\t\t\t   that user.\n\t\t\t\t   \n    - 'GetContacts' - Returns requesting user's Contact List.\n\t\n\t- 'GetId' - Returns requesting user's database Id.\n\t\n\t- 'AddContact' - Adds a contact to the requesting user's contact list.\n\t\n\t- 'NewUser' - Adds a new user to the messenger app.\n\n[Error List]:\n\n\t- Forbidden (403) - Thrown when a user's credentials fail to Authenticate.\n\n\t- Precondition Failed (412) - Thrown when an API call lacks essential post information.\n\n*/   \n\nclass Conversation {\n\n\tpublic $Contact;\n\tpublic $Messages;\n\tpublic $ConversationId;\n\t\n\tfunction __construct($par1, $par2, $par3) {\n\t\t$this->Messages = $par1;\n\t\t$this->ConversationId = $par2;\n\t\t$this->Contact = $par3;\n\t}\n}\n\nclass PossibleObject {\n\t\n\tpublic $ConversationName;\n\tpublic $ContactName;\n\t\n\tfunction __construct($par1, $par2) {\n\t\t\n\t\t$this->ConversationName = $par1;\n\t\t$this->ContactName = $par2;\n\t\t\n\t}\n\t\n}\n\nclass HttpResponse {\n\n\t//Error\n\tconst STATUS_PRECONDITION_FAILED = 412;\n\tconst STATUS_FORBIDDEN = 403;\n\tconst STATUS_INTERNAL_SERVER_ERROR = 500;\n\tconst STATUS_UNPROCESSABLE_ENTITY = 422;\n\tconst STATUS_CONFLICT = 409;\n\tconst STATUS_SERVICE_ERROR = 503;\n\tconst STATUS_BAD_REQUEST = 400;\n\t\n\t//Success\n\tconst STATUS_OK = 200;\n\tconst STATUS_CREATED = 201;\n\tconst STATUS_ACCEPTED = 202;\n\tconst STATUS_UNAUTHORIZED = 401;\n\t\n\tpublic $Status;\n\tpublic $Response;\n\t\n\tfunction __construct($par1, $par2) {\n\t\t$this->Status = $par1;\n\t\t$this->Response = $par2;\n\t}\n\t\n}\n\n/*\n$TempUser['Id'] = \"3\";\n$TempUser['Username'] = \"Warpeddemon\" ;\n$TempUser['Password'] =  \"pass\";\n$TempUser['Status'] = \"User\";\n$TempUser['Banned'] = \"false\";\n$TempUser['Contacts'] = \"[{}]\";  \n\n  \n$Person2['Username'] = \"RightBehindu\";\n$Person2['Id'] = \"1\"; \n*/\n//$Person3['Username'] = \"bob\";\n//$Person3['Id'] = \"2\";\n  /* \n // TEST CHUNK #1 \n \n$_POST['Username'] = \"Warpeddemon\";\n$_POST['Password'] = \"pass\";\n$_POST['Message'] = \"HELLO THAR\";\n$_POST['Request'] = \"AcceptFriendRequest\";\n$_POST['Contact'] = $Person2;  \n*/\n// TEST CHUNK #2 \n$_POST['Username'] = \"RightBehindu\";\n$_POST['Password'] = \"yellow12\";\n$_POST['Request'] = \"FriendRequest\";\n$_POST['Contact'] = '{\"Id\":\"1\",\"Username\":\"bill\"}';\n$_POST['Message'] = \"Hhi\";  \n\n \nif($_POST) {\n\t//If attempting to access sensitive data which requires user credentials.\n\tif(!isset($_POST['Username']) || !isset($_POST['Password']) || !isset($_POST['Request'])) {\n\t\t//If the base expected POST variables are not met, throw error 412.\n\t\techo ThrowPrecondition();\n\t\treturn;\n\t}\n\t\n\t$Request = $_POST['Request'];\n\t$User = AuthenticateUser($_POST['Username'], $_POST['Password']);\n\t\n\t//If the user is returned as false, throw a forbidden 403 error.\n\tif($User === false) {\n\t\tThrowUnauthorized();\n\t\treturn;\n\t}\n\n\t\n\t// API EVENT REQUESTS  //\n\t\n\tif($Request === \"Login\") {\n\t\techo json_encode($User);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"NewUser\") {\n\t\tif(!isset($_POST['NewUser'])) {\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t} else {\n\t\t\tif($User['Status'] === \"Admin\") {\n\t\t\t\tAddNewUser($_POST['Username'], $_POST['Password'], $_POST['NewUser']);\n\t\t\t} else {\n\t\t\t\tThrowForbidden();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\tif($Request === \"GetContacts\") {\n\t\techo json_encode($User['Contacts']);\n\t\treturn;\n\t} \n\t\n\tif($Request === \"GetId\") {\n\t\techo json_encode($User['Id']);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"AddContact\") {\n\t\tif(!isset($_POST['NewContact'])) {\n\t\t\t//If the new contact to add has not been defined.\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t} else {\n\t\t\t$result = AddContact($_POST['Username'], $_POST['Password'], $_POST['NewContact']);\n\t\t\tif($result) {\n\t\t\t\techo true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tThrowService();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif($Request === \"NewConversation\") {\n\t\tif(!isset($_POST['Contact'])) {\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t}\n\t\tCreateNewConversation($User, $_POST['Contact']);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"AddContactsTemp\") {\n\t\trun($_POST['Username'], $_POST['Password']);\n\t}\n\t\n\t\n\tif($Request === \"NewMessage\") {\n\t\tif(!isset($_POST['Message']) || !isset($_POST['Contact'])) {\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t}\n\t\t$_POST['Contact'] = json_decode($_POST['Contact']);\n\t\tSendMessage($User, $_POST['Message'], $_POST['Contact']);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"FriendRequest\") {\n\t\tif(!isset($_POST['Contact'])) {\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t$result = SendFriendRequest($User, json_decode($_POST['Contact']));\n\t\tif($result) {\n\t\t\techo json_encode(new HttpResponse(HttpResponse::STATUS_ACCEPTED, \"true\"));\n\t\t\treturn;\n\t\t} else {\n\t\t\treturn;\t\n\t\t}\n\t}\n\t\n\tif($Request === \"AcceptFriendRequest\") {\n\t\tif(!isset($_POST['Contact'])) {\n\t\t\tThrowPrecondition();\n\t\t\treturn;\n\t\t}\n\t\tAcceptFriendRequest($User, $_POST['Contact']);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"GetConversations\") {\n\t\tGetConversationList($User);\n\t\treturn;\n\t}\n\t\n\tif($Request === \"GetFriendRequests\") {\n\t\tGetFriendRequests($User);\n\t\treturn;\n\t}\n\t\n\techo $Request;\n\tThrowBadRequest();\n\treturn;\n} else {\n\t\n\techo \"This is API, wut r u doin...\";\n\t\n}\n\n\t// API FUNCTIONS //\n\n//Accepts a friend request for a user from a parsed contact.\nfunction AcceptFriendRequest($User, $Contact) {\n\t\n\t$db = CreateConnectionObject();\n\tif($db === false) { ThrowService(); return; }\n\t\n\t$CurrentFriendRequests = json_decode($User['FriendRequests'], true);\n\t\n\tif($CurrentFriendRequests === null) {\n\t\tThrowInternal();\n\t\treturn;\n\t}\n\tfor($i = 0; $i < count($CurrentFriendRequests); $i++) {\n\t\t$request = $CurrentFriendRequests[$i];\n\t\tif($request['Username'] === $Contact['Username']) {\n\t\t\t$NewFriendRequests = $CurrentFriendRequests;\n\t\t\tarray_splice($NewFriendRequests, $i, 1);\n\t\t\t$result = UpdateUserRequests($User, $NewFriendRequests, $db);\n\t\t\tAddContact($User['Username'], $User['Password'], $Contact);\n\t\t\tif(!$result) {\n\t\t\t\t//If there was no update.\n\t\t\t\tThrowInternal();\n\t\t\t\tThrowService();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\techo \"\\nAccepted!\";\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\tThrowInternal();\n\treturn false;\n}\n\n//Updates a users friend requests with a parsed friend request. Used in SendFriendRequest.\nfunction UpdateUserRequests($User, $FriendRequests, $db) {\n\n\t\n\t$stmt = \"UPDATE logins SET FriendRequests=:friends WHERE Username=:username AND Id=:id\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array('friends'=>json_encode($FriendRequests), 'username'=>$User['Username'],'id'=>$User['Id']));\n\t\n\t$result = $query->rowCount();\n\t\n\tif($result > 0) {\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}\n\t\n//Sends a friend request from a user to a parsed contact.\nfunction SendFriendRequest($User, $Contact) {\n\t\n\t$db = CreateConnectionObject();\n\tif($db === false) { ThrowService(); return; }\n\t\n//\treturn true;\n\n\tif(isFriend($User, $Contact, $db)) {\n\t\t//echo \"not found...1 \" . $Contact;\n\t\techo json_encode(new HttpResponse(HttpResponse::STATUS_BAD_REQUEST, \"false\"));\n\t\treturn false;\n\t}\n\n\t\n\tif(FriendRequestAlreadySent($User, $Contact, $db)) {\n\t//\techo \"not found...2 \" . $Contact;\n\t\techo json_encode(new HttpResponse(HttpResponse::STATUS_BAD_REQUEST, \"false\"));\n\t\treturn false;\n\t}\n\n\t$newFriendRequest = array();\n\t$newFriendRequest['Id'] = $User['Id'];\n\t$newFriendRequest['Username'] = $User['Username'];\n\t$newFriendList = json_decode($User['FriendRequests'], true);\n\t\n\tif($newFriendList === null) {\n\t\t$newFriendList = array();\n\t} \n\tarray_push($newFriendList, $newFriendRequest);\n\t$stmt = \"UPDATE logins SET FriendRequests=:friends WHERE Username=:contact;\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array('friends'=>json_encode($newFriendList), 'contact'=>$Contact['Username']));\n\t$result = $query->rowCount();\n\tif($result > 0) {\n\t\techo \"Successfully updated \" . $result . \" rows!\";\n\t\treturn true;\n\t} else {\n\t\techo \"not found... \" . $Contact;\n\t\techo json_encode(new HttpResponse(HttpResponse::STATUS_BAD_REQUEST, \"false\"));\n\t\treturn false;\n\t}\n}\t\n\n//Returns whether or not a user already has sent a friend request to a parsed contact.\nfunction FriendRequestAlreadySent($User, $Contact, $db) {\n\n\t$stmt = \"SELECT * FROM logins WHERE Username=:contact_username\";\n\t\n\t$query = $db->prepare($stmt);\n\t$query->execute(array('contact_username'=>$Contact['Username']));\n\t\n\t$result = $query->fetchAll(PDO::FETCH_ASSOC);\n\t\n\treturn true;\n\t$TempFriendRequests = json_decode($result[0]['FriendRequests'], true);\n\tif($TempFriendRequests !== null) {\n\t\tforeach($TempFriendRequests as $request) {\n\t\t\tif($request['Username'] === $Contact['Username']) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n}\n\n//Sends a message from a user to a parsed contact.\nfunction SendMessage($User, $Message, $Contact) {\n\t\n\t$db = CreateConnectionObject();\n\tif($db === false) { ThrowService(); return false; }\n\n\tif(!IsFriend($User, $Contact, $db)) {\n\t\techo \"Missing Requirements - User is not a friend!\";\n\t\treturn;\n\t}\n\t$tableName = CreateConversationString($User['Username'], $Contact->Username);\n\n\tif(!ConversationExistsFromString($tableName, $db)) {\n\t\tCreateNewConversation($User, $Contact);\n\t}\n\t$stmt = \"INSERT INTO \" . $tableName . \" (sender, message) VALUES (:sender, :message);\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array('sender'=>$User['Username'], 'message'=>$Message));\n\t\n\t$result = $query->rowCount();\n\techo $result;\n\tif($result > 0) {\n\t\treturn true;\n\t} else {\n\t\tThrowService();\n\t\treturn false;\n\t}\n}\n\nfunction RemoveContact($User, $Contact) {\n\t$db = CreateConnectionObject();\n\tif($db === false) { ThrowService(); return false; }\n\t\n\tif(!IsFriend($User, $Contact, $db)) {\n\t\tThrowInternal();\n\t}\n\t\n\t\n}\n\n//Returns whether or not a user is friends with a parsed contact.\nfunction IsFriend($User, $Contact, $db) {\n\techo $Contact;\n\treturn true;\n\t$ExistingContactList = GetContacts($User['Username'], $User['Password']);\n\t$ContactList = json_decode($ExistingContactList, true);\n\tfor($i = 0; $i < count($ContactList); $i++) {\n\n\t\tif($ContactList[$i]['Username'] === $Contact->Username) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n\n}\n\n//Creates a new conversation between are user and a parsed contact.\nfunction CreateNewConversation($user, $contact) {\n\t\n\t$db = CreateConnectionObject();\n\t//$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\t\n\tif(ConversationExists($user, $contact, $db)) {\n\t\tThrowConflict();\n\t\treturn false;\n\t}\n\t$tableName = CreateConversationString($user['Username'], $contact->Username);\n\t$stmt = \"CREATE TABLE \" . $tableName . \" (\n    id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY, \n    sender VARCHAR(30) NOT NULL,\n    message VARCHAR(30) NOT NULL,\n    sent_time TIMESTAMP\n    );\";\n\t\t\t\t\t\n\n\t$query = $db->exec($stmt);\n\techo \"Conversation Made!\";\n}\n\n//Returns whether or not a conversation exists between a user and a parsed contact.\nfunction ConversationExists($user, $contact, $db) {\n\t$tableName = CreateConversationString($user['Username'], $contact->Username);\n\t$stmt = \"SHOW TABLES LIKE '\" . $tableName . \"';\";\n\t$query = $db->prepare($stmt);\n\t$query->execute();\n\t\n\t$result = $query->rowCount();\n\tif($result > 0) {\n\t\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n} \n\n//Returns whether or not a conversation exists based of a preconstructed conversation name string.\nfunction ConversationExistsFromString($string, $db) {\n\t$string = strtolower($string);\n\t$stmt = \"SHOW TABLES LIKE '\" . $string . \"';\";\n\t$query = $db->prepare($stmt);\n\t$query->execute();\n\t$result = $query->rowCount();\n\tif($result > 0) {\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}\n\n//Adds a new user to the logins database. Can only be called by Admin status accounts.\nfunction AddNewUser($username, $password, $User) {\n\t$db = CreateConnectionObject();\n\tif($db === false) { \n\t\tThrowService();\n\t\treturn false;\n\t}\n\t\n\t$stmt = \"INSERT INTO logins (Username, Password, Status, Banned, Contacts)\n\t\t\t      VALUES (:username, :password, :status, :banned, :contact);\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array('username'=>$User['Username'], 'password'=>$User['Password'], 'status'=>$User['Status'], 'banned'=>'false', 'contact'=>'[]'));\n\t\n\t$result = $query->rowCount();\n\techo \"Added \" . $result . \" users!\";\n\t\n}\n\n//Adds a contact to the requesting user.\nfunction AddContact($username, $password, $Contact) {\n\t$CurrentContacts = GetContacts($username, $password);\n\t$ContactList = json_decode($CurrentContacts, true);\n\t\n\tif($ContactList === null) {\n\t\t$ContactList = array();\n\t}\n\t\n\tarray_push($ContactList, $Contact);\n\t\n\t$db = CreateConnectionObject();\n\tif($db === false) { \n\t\tThrowService();\n\t\treturn false;\n\t}\n\n\t$stmt = \"UPDATE logins SET Contacts=:contacts WHERE Username=:username AND Password=:password;\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array(\"contacts\"=>json_encode($ContactList), \"username\"=>$username, \"password\"=>$password));\n\t\n\t$result = $query->rowCount();\n\tif($result > 0) {\n\t\techo \"Successfully updated \" . $result . \" rows!\";\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n\t\n}\n\n//Returns a list of contacts for the requesting user.\nfunction GetContacts($username, $password) {\n\t$db = CreateConnectionObject();\n\tif($db === false) { \n\t\tThrowService();\n\t\treturn false;\n\t}\n\t\n\t$stmt = \"SELECT * FROM logins WHERE Username=:username AND Password=:password;\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array(\"username\"=>$username, \"password\"=>$password));\n\t\n\t$result = $query->fetchAll(PDO::FETCH_ASSOC);\n\tif(isset($result[0])) {\n\t\treturn $result[0]['Contacts'];\n\t} else {\n\t\tThrowForbidden();\n\t}\n}\n\n//Returns a list of Friend Requests for a given user.\nfunction GetFriendRequests($User) {\n\t$db = CreateConnectionObject();\n\tif($db === false) { \n\t\tThrowService();\n\t\treturn false;\n\t}\n\t\n\t$stmt = \"SELECT * FROM logins WHERE Username=:username AND Password=:password;\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array(\"username\"=>$User['Username'], \"password\"=>$User['Password']));\n\t\n\t$result = $query->fetchAll(PDO::FETCH_ASSOC);\n\tif(isset($result[0])) {\n\t\techo json_encode($result[0]['FriendRequests']);\n\t} else {\n\t\tThrowForbidden();\n\t}\n}\n\n//Returns a list of conversations for a given user.\nfunction GetConversationList($User) {\n\t$Contacts = json_decode(GetContacts($User['Username'], $User['Password']), true);\n\t//echo json_encode($Contacts);\n\t$PossibleConversations = array();\n\t\n\tforeach($Contacts as $contact) {\n\t\t$convoName = CreateConversationString($User['Username'], $contact['Username']);\n\t\t$PossibleConversationObject = new PossibleObject($convoName, $contact['Username']);\n\t\tarray_push($PossibleConversations, $PossibleConversationObject);\n\t}\n\t\n\t\n\t\n\t$db = CreateConnectionObject();\n\tif($db === false) { ThrowService(); return; }\n\t\n\t$ConversationList = array();\n\t\n\tforeach($PossibleConversations as $conversationObject) {\n\t\tif(ConversationExistsFromString($conversationObject->ConversationName, $db)) {\n\t\t\t$conversationString = strtolower($conversationObject->ConversationName);\n\t\t\t\n\t\t\t$stmt = \"SELECT * FROM \". $conversationString .\";\";\n\t\t\t$query = $db->prepare($stmt);\n\t\t\t$query->execute();\n\t\t\t\n\t\t\t$result = $query->fetchAll(PDO::FETCH_ASSOC);\n\t\t\t\n\t\t\t$Conversation = new Conversation($result, $conversationString, $conversationObject->ContactName);\n\t\t\tarray_push($ConversationList, $Conversation);\n\t\t}\n\t}\n\t\n\t//ThrowDefaultSuccess($ConversationList);\n\techo json_encode($ConversationList);\n}\n\n//Validates user credentials and returns the user.\nfunction AuthenticateUser($username, $password) {\n\n\t$db = CreateConnectionObject();\n\tif($db === false) { \n\t\tThrowService();\n\t\treturn false;\n\t}\n\t\n\t$stmt = \"SELECT * FROM logins WHERE Username=:username AND Password=:password;\";\n\t$query = $db->prepare($stmt);\n\t$query->execute(array(\"username\"=>$username, \"password\"=>$password));\n\t\n\t$results = $query->fetchAll(PDO::FETCH_ASSOC);\n\t\n\tif(isset($results[0])) {\n\t\treturn $results[0];\n\t} else {\n\t\treturn false;\n\t}\n\t\n}\n\n//Creates the database object used in many other api functions.\nfunction CreateConnectionObject() {\n\ttry {\n\t\t$dsn = \"mysql:host=223.27.22.124;dbname=04student_AppDatabaseMessaging;charset=utf8;\";\n\t\t$db = new PDO($dsn, 'PrinceWarped', 'yellow12');\n\t}\n\tcatch(PDOException $e) {\n\t\t//If the database object cannot be instantiated.\n\t\techo $e->getMessage();\n\t\treturn false;\n\t}\n\t\n\tif(isset($db)) {\n\t\tif($db == null) {\n\t\t\treturn false;\n\t\t}\n\t\treturn $db;\n\t} else {\n\t\treturn false;\n\t}\n}\n\n\n// Other Functions //\n\n//Returns a the correct format for a conversation table name between two usernames.\nfunction CreateConversationString($nameOne, $nameTwo) {\n\t$index = 0;\n\twhile($nameOne[$index] === $nameTwo[$index]) {\n\t\t$index++;\n\n\t\tif($index > strlen($nameOne)-1) {\t\t\t\n\t\t\treturn \"conversation_\" . $nameOne . \"_\" . $nameTwo;\n\t\t}\n\t\tif( $index > strlen($nameTwo)-1) {\n\t\t\treturn \"conversation_\" . $nameTwo . \"_\" . $nameOne;\n\t\t}\n\t}\n\t\n\tif(strtolower($nameOne[$index]) < strtolower($nameTwo[$index])) {\n\n\t\treturn \"conversation_\" . strtolower($nameOne) . \"_\" . strtolower($nameTwo);\n\t} else {\n\t\treturn \"conversation_\" . strtolower($nameTwo) . \"_\" . strtolower($nameOne);\n\t}\n}\n\n// Error Throwing Functions //\n\nfunction ThrowPrecondition() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_PRECONDITION_FAILED, \"Precondition Failed (412).\");\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowForbidden() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_FORBIDDEN, \"Forbidden. Insufficient Permissions (403).\");\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowUnauthorized() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_UNAUTHORIZED, \"Forbidden. Authentication Failed (401).\");\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowService() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_SERVICE_ERROR,  \"Service Unavailable (503) - Server Unavailable.\");\n\techo json_encode($HttpResponse);\n\t\n}\n\nfunction ThrowConflict() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_CONFLICT,  \"Conflict (409) - Resource already exists.\");\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowInternal() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_CONFLICT,  \"Internal Server Error (500).\");\n\techo json_encode($HttpResponse);\n\treturn;\n}\n\nfunction ThrowDefaultSuccess($Response) {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_OK, $Response);\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowSuccess($Status, $Response) {\n\t$HttpResponse = new HttpResponse($Status, $Response);\n\techo json_encode($HttpResponse);\n}\n\nfunction ThrowBadRequest() {\n\t$HttpResponse = new HttpResponse(HttpResponse::STATUS_BAD_REQUEST, \"Bad Request (400)\");\n\techo \"not found... the fuck?\";\n\techo json_encode($HttpResponse);\n}\n// Test Functions //\n\nfunction run($username, $password) {\n\t//This function is purely a test function to add a couple of contacts to a new user whom doesn't have any yet.\n \n\t$Person['Username'] = \"bob\";\n\t$Person['Id'] = \"10\"; \n\t $Person2['Username'] = \"bill\";\n\t$Person2['Id'] = \"11\"; \n\t$Person3['Username'] = \"baxter\";\n\t$Person3['Id'] = \"12\"; \n\t$TempContacts = array();\n\tarray_push($TempContacts, $Person);\n\tarray_push($TempContacts, $Person2);\n\tarray_push($TempContacts, $Person3);\n\n\n\t$db = CreateConnectionObject();\n\t\n\t$stmt = \"UPDATE logins SET Contacts=:contact WHERE Username=:username AND Password=:password;\"; \n\n\t$query = $db->prepare($stmt);\n\t$query->execute(array(\"contact\"=> json_encode($TempContacts), \"username\"=>$username, \"password\"=>$password));\n\n\techo \"ran\";\n}\n\n?>","undoManager":{"mark":96,"position":100,"stack":[[{"start":{"row":348,"column":1},"end":{"row":348,"column":2},"action":"insert","lines":["s"],"id":1622}],[{"start":{"row":348,"column":1},"end":{"row":348,"column":2},"action":"remove","lines":["s"],"id":1623}],[{"start":{"row":343,"column":57},"end":{"row":344,"column":0},"action":"insert","lines":["",""],"id":1624},{"start":{"row":344,"column":0},"end":{"row":344,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":344,"column":1},"end":{"row":344,"column":2},"action":"insert","lines":["e"],"id":1625}],[{"start":{"row":344,"column":2},"end":{"row":344,"column":3},"action":"insert","lines":["h"],"id":1626}],[{"start":{"row":344,"column":2},"end":{"row":344,"column":3},"action":"remove","lines":["h"],"id":1627}],[{"start":{"row":344,"column":2},"end":{"row":344,"column":3},"action":"insert","lines":["h"],"id":1628}],[{"start":{"row":344,"column":3},"end":{"row":344,"column":4},"action":"insert","lines":["o"],"id":1629}],[{"start":{"row":344,"column":3},"end":{"row":344,"column":4},"action":"remove","lines":["o"],"id":1630}],[{"start":{"row":344,"column":2},"end":{"row":344,"column":3},"action":"remove","lines":["h"],"id":1631}],[{"start":{"row":344,"column":2},"end":{"row":344,"column":3},"action":"insert","lines":["c"],"id":1632}],[{"start":{"row":344,"column":3},"end":{"row":344,"column":4},"action":"insert","lines":["h"],"id":1633}],[{"start":{"row":344,"column":4},"end":{"row":344,"column":5},"action":"insert","lines":["o"],"id":1634}],[{"start":{"row":344,"column":5},"end":{"row":344,"column":6},"action":"insert","lines":[" "],"id":1635}],[{"start":{"row":344,"column":6},"end":{"row":344,"column":7},"action":"insert","lines":["$"],"id":1636}],[{"start":{"row":344,"column":7},"end":{"row":344,"column":8},"action":"insert","lines":["C"],"id":1637}],[{"start":{"row":344,"column":8},"end":{"row":344,"column":9},"action":"insert","lines":["o"],"id":1638}],[{"start":{"row":344,"column":9},"end":{"row":344,"column":10},"action":"insert","lines":["n"],"id":1639}],[{"start":{"row":344,"column":10},"end":{"row":344,"column":11},"action":"insert","lines":["t"],"id":1640}],[{"start":{"row":344,"column":11},"end":{"row":344,"column":12},"action":"insert","lines":["a"],"id":1641}],[{"start":{"row":344,"column":12},"end":{"row":344,"column":13},"action":"insert","lines":["c"],"id":1642}],[{"start":{"row":344,"column":13},"end":{"row":344,"column":14},"action":"insert","lines":["t"],"id":1643}],[{"start":{"row":344,"column":14},"end":{"row":345,"column":0},"action":"insert","lines":["",""],"id":1644},{"start":{"row":345,"column":0},"end":{"row":345,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":345,"column":1},"end":{"row":345,"column":2},"action":"insert","lines":["e"],"id":1645}],[{"start":{"row":345,"column":1},"end":{"row":345,"column":2},"action":"remove","lines":["e"],"id":1646}],[{"start":{"row":345,"column":1},"end":{"row":345,"column":2},"action":"insert","lines":["r"],"id":1647}],[{"start":{"row":345,"column":2},"end":{"row":345,"column":3},"action":"insert","lines":["e"],"id":1648}],[{"start":{"row":345,"column":3},"end":{"row":345,"column":4},"action":"insert","lines":["t"],"id":1649}],[{"start":{"row":345,"column":4},"end":{"row":345,"column":5},"action":"insert","lines":["u"],"id":1650}],[{"start":{"row":345,"column":5},"end":{"row":345,"column":6},"action":"insert","lines":["r"],"id":1651}],[{"start":{"row":345,"column":6},"end":{"row":345,"column":7},"action":"insert","lines":["n"],"id":1652}],[{"start":{"row":345,"column":7},"end":{"row":345,"column":8},"action":"insert","lines":[" "],"id":1653}],[{"start":{"row":345,"column":8},"end":{"row":345,"column":9},"action":"insert","lines":["t"],"id":1654}],[{"start":{"row":345,"column":9},"end":{"row":345,"column":10},"action":"insert","lines":["r"],"id":1655}],[{"start":{"row":345,"column":10},"end":{"row":345,"column":11},"action":"insert","lines":["u"],"id":1656}],[{"start":{"row":345,"column":11},"end":{"row":345,"column":12},"action":"insert","lines":["e"],"id":1657}],[{"start":{"row":345,"column":12},"end":{"row":345,"column":13},"action":"insert","lines":[";"],"id":1658}],[{"start":{"row":311,"column":2},"end":{"row":312,"column":0},"action":"insert","lines":["",""],"id":1659},{"start":{"row":312,"column":0},"end":{"row":312,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":312,"column":1},"end":{"row":313,"column":0},"action":"insert","lines":["",""],"id":1660},{"start":{"row":313,"column":0},"end":{"row":313,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":313,"column":1},"end":{"row":313,"column":2},"action":"insert","lines":["r"],"id":1661}],[{"start":{"row":313,"column":2},"end":{"row":313,"column":3},"action":"insert","lines":["e"],"id":1662}],[{"start":{"row":313,"column":3},"end":{"row":313,"column":4},"action":"insert","lines":["t"],"id":1663}],[{"start":{"row":313,"column":4},"end":{"row":313,"column":5},"action":"insert","lines":["u"],"id":1664}],[{"start":{"row":313,"column":5},"end":{"row":313,"column":6},"action":"insert","lines":["r"],"id":1665}],[{"start":{"row":313,"column":6},"end":{"row":313,"column":7},"action":"insert","lines":["n"],"id":1666}],[{"start":{"row":313,"column":7},"end":{"row":313,"column":8},"action":"insert","lines":[" "],"id":1667}],[{"start":{"row":313,"column":8},"end":{"row":313,"column":9},"action":"insert","lines":["t"],"id":1668}],[{"start":{"row":313,"column":9},"end":{"row":313,"column":10},"action":"insert","lines":["r"],"id":1669}],[{"start":{"row":313,"column":10},"end":{"row":313,"column":11},"action":"insert","lines":["u"],"id":1670}],[{"start":{"row":313,"column":11},"end":{"row":313,"column":12},"action":"insert","lines":["e"],"id":1671}],[{"start":{"row":313,"column":12},"end":{"row":313,"column":13},"action":"insert","lines":[";"],"id":1672}],[{"start":{"row":316,"column":1},"end":{"row":316,"column":2},"action":"insert","lines":["/"],"id":1673}],[{"start":{"row":316,"column":2},"end":{"row":316,"column":3},"action":"insert","lines":["/"],"id":1674}],[{"start":{"row":312,"column":0},"end":{"row":313,"column":13},"action":"remove","lines":["\t","\treturn true;"],"id":1675}],[{"start":{"row":345,"column":0},"end":{"row":346,"column":13},"action":"remove","lines":["\techo $Contact","\treturn true;"],"id":1676}],[{"start":{"row":406,"column":41},"end":{"row":407,"column":0},"action":"insert","lines":["",""],"id":1677},{"start":{"row":407,"column":0},"end":{"row":407,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":407,"column":1},"end":{"row":407,"column":2},"action":"insert","lines":["e"],"id":1678}],[{"start":{"row":407,"column":2},"end":{"row":407,"column":3},"action":"insert","lines":["c"],"id":1679}],[{"start":{"row":407,"column":3},"end":{"row":407,"column":4},"action":"insert","lines":["h"],"id":1680}],[{"start":{"row":407,"column":4},"end":{"row":407,"column":5},"action":"insert","lines":["o"],"id":1681}],[{"start":{"row":407,"column":5},"end":{"row":407,"column":6},"action":"insert","lines":[" "],"id":1682}],[{"start":{"row":407,"column":6},"end":{"row":407,"column":7},"action":"insert","lines":["$"],"id":1683}],[{"start":{"row":407,"column":7},"end":{"row":407,"column":8},"action":"insert","lines":["C"],"id":1684}],[{"start":{"row":407,"column":8},"end":{"row":407,"column":9},"action":"insert","lines":["o"],"id":1685}],[{"start":{"row":407,"column":9},"end":{"row":407,"column":10},"action":"insert","lines":["n"],"id":1686}],[{"start":{"row":407,"column":10},"end":{"row":407,"column":11},"action":"insert","lines":["t"],"id":1687}],[{"start":{"row":407,"column":11},"end":{"row":407,"column":12},"action":"insert","lines":["a"],"id":1688}],[{"start":{"row":407,"column":12},"end":{"row":407,"column":13},"action":"insert","lines":["c"],"id":1689}],[{"start":{"row":407,"column":13},"end":{"row":407,"column":14},"action":"insert","lines":["t"],"id":1690}],[{"start":{"row":407,"column":14},"end":{"row":407,"column":15},"action":"insert","lines":[";"],"id":1691}],[{"start":{"row":407,"column":15},"end":{"row":408,"column":0},"action":"insert","lines":["",""],"id":1692},{"start":{"row":408,"column":0},"end":{"row":408,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":408,"column":1},"end":{"row":408,"column":2},"action":"insert","lines":["r"],"id":1693}],[{"start":{"row":408,"column":2},"end":{"row":408,"column":3},"action":"insert","lines":["e"],"id":1694}],[{"start":{"row":408,"column":3},"end":{"row":408,"column":4},"action":"insert","lines":["t"],"id":1695}],[{"start":{"row":408,"column":4},"end":{"row":408,"column":5},"action":"insert","lines":["u"],"id":1696}],[{"start":{"row":408,"column":5},"end":{"row":408,"column":6},"action":"insert","lines":["r"],"id":1697}],[{"start":{"row":408,"column":6},"end":{"row":408,"column":7},"action":"insert","lines":["n"],"id":1698}],[{"start":{"row":408,"column":7},"end":{"row":408,"column":8},"action":"insert","lines":[" "],"id":1699}],[{"start":{"row":408,"column":8},"end":{"row":408,"column":9},"action":"insert","lines":["t"],"id":1700}],[{"start":{"row":408,"column":9},"end":{"row":408,"column":10},"action":"insert","lines":["r"],"id":1701}],[{"start":{"row":408,"column":10},"end":{"row":408,"column":11},"action":"insert","lines":["u"],"id":1702}],[{"start":{"row":408,"column":11},"end":{"row":408,"column":12},"action":"insert","lines":["e"],"id":1703}],[{"start":{"row":408,"column":12},"end":{"row":408,"column":13},"action":"insert","lines":[";"],"id":1704}],[{"start":{"row":305,"column":46},"end":{"row":306,"column":0},"action":"insert","lines":["",""],"id":1705},{"start":{"row":306,"column":0},"end":{"row":306,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":306,"column":1},"end":{"row":307,"column":0},"action":"insert","lines":["",""],"id":1706},{"start":{"row":307,"column":0},"end":{"row":307,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":307,"column":1},"end":{"row":307,"column":2},"action":"insert","lines":["r"],"id":1707}],[{"start":{"row":307,"column":2},"end":{"row":307,"column":3},"action":"insert","lines":["e"],"id":1708}],[{"start":{"row":307,"column":3},"end":{"row":307,"column":4},"action":"insert","lines":["t"],"id":1709}],[{"start":{"row":307,"column":4},"end":{"row":307,"column":5},"action":"insert","lines":["u"],"id":1710}],[{"start":{"row":307,"column":5},"end":{"row":307,"column":6},"action":"insert","lines":["r"],"id":1711}],[{"start":{"row":307,"column":6},"end":{"row":307,"column":7},"action":"insert","lines":["n"],"id":1712}],[{"start":{"row":307,"column":7},"end":{"row":307,"column":8},"action":"insert","lines":[" "],"id":1713}],[{"start":{"row":307,"column":8},"end":{"row":307,"column":9},"action":"insert","lines":["t"],"id":1714}],[{"start":{"row":307,"column":9},"end":{"row":307,"column":10},"action":"insert","lines":["r"],"id":1715}],[{"start":{"row":307,"column":10},"end":{"row":307,"column":11},"action":"insert","lines":["u"],"id":1716}],[{"start":{"row":307,"column":11},"end":{"row":307,"column":12},"action":"insert","lines":["e"],"id":1717}],[{"start":{"row":307,"column":12},"end":{"row":307,"column":13},"action":"insert","lines":[";"],"id":1718}],[{"start":{"row":310,"column":2},"end":{"row":310,"column":3},"action":"insert","lines":["/"],"id":1719}],[{"start":{"row":310,"column":3},"end":{"row":310,"column":4},"action":"insert","lines":["/"],"id":1720}],[{"start":{"row":307,"column":0},"end":{"row":307,"column":1},"action":"insert","lines":["/"],"id":1721}],[{"start":{"row":307,"column":1},"end":{"row":307,"column":2},"action":"insert","lines":["/"],"id":1722}]]},"ace":{"folds":[],"scrolltop":5376.5,"scrollleft":0,"selection":{"start":{"row":307,"column":2},"end":{"row":307,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":383,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1511366476152}